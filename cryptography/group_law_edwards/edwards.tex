% Thomas Hales
% Hyperbolic Addition on Edwards Curves
% May 2016.
% May 11, 2016. Added hyperbolic material.
% May 12, 2016. Submission to MAA (rejected).
% Aug 2016. Projective curves added.
% October 5, 2016. Rewritten to remove MAA expository style.

\documentclass[18pt]{article}

\usepackage{graphicx}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amscd}
\usepackage{amssymb}
\usepackage{alltt}
\usepackage{url}
\usepackage{ellipsis}
% 
%tikz graphics
%\usepackage{xcolor} % to remove color.
\usepackage{tikz} % 
\usetikzlibrary{chains,shapes,arrows,trees,matrix,positioning,decorations}

\def\tikzfig#1#2#3{%
\begin{figure}[htb]%
  \centering
\begin{tikzpicture}#3
\end{tikzpicture}
  \caption{#2}
  \label{fig:#1}%
\end{figure}%
}
\def\smalldot#1{\draw[fill=black] (#1) node [inner sep=1.3pt,shape=circle,fill=black] {}}

\newtheorem{theorem}{Theorem}[section]
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{definition}[theorem]{Definition}



\newcommand{\ring}[1]{\mathbb{#1}}
\newcommand{\op}[1]{\hbox{#1}}
\newcommand{\f}[1]{\frac{1}{#1}}
%\newcommand{\text}[1]{\hbox{#1}}
\newcommand{\Eo}{E^\circ}
\newcommand{\Eoo}{E^{\circ\circ}}
\newcommand{\hplus}{\hat\oplus}
\newcommand{\Go}{\langle\rho\rangle}
\def\cong{\equiv}

\title{The Group Law for Edwards Curves}
\author{Thomas C. Hales}
\date{October 5, 2016}

\begin{document}

\maketitle

\begin{abstract} 
  This article gives an elementary computational proof of the group
  law for Edwards elliptic curves following Edwards, Bernstein, Lange, et al.,
  and Friedl.  The associative law is expressed as a polynomial
  identity over the integers that is directly checked by polynomial division.
  No preliminaries such as intersection numbers, 
  B\'ezout's theorem, projective geometry, divisors,
  or Riemann Roch are required. This article has been written for the benefit
  of undergraduate cryptography students.  The proofs have been designed
  to facilitate the formal verification of elliptic curve cryptography.
\end{abstract}

\parskip=0.8\baselineskip

\newenvironment{blockquote}{%
  \par%
  \medskip%
  \baselineskip=0.7\baselineskip%
  \leftskip=2em\rightskip=2em%
  \noindent\ignorespaces}{%
  \par\medskip}


\section{The Circle}

The unit circle $U$ in the complex plane $\ring{C}$ is a group under
complex multiplication, or equivalently under the addition of angles in polar coordinates.  
%\subsection{Hyperbolic addition}
We write $\iota(x,y) =
(x,-y)$ for complex conjugation, the inverse in the group
$U$.

We give an unusual interpretation of the group law on the unit circle
that we call {\it hyperbolic addition}.  We consider the family of
hyperbolas in the plane that pass through the point $z=(-1,0)$ and
whose asymptotes are parallel to the coordinate axes.  The equation of
such a hyperbola has the form
\begin{equation}\label{eqn:hyp}
x y + p (x+1) + q y = 0.
\end{equation}
All hyperbolas in this article are assumed to be of this form.
  As special cases (such as $x y=0$), this family includes pairs of lines.
  
We fix a hyperbola within the family by the condition that the
hyperbola must pass through the two points $z_1$ and $z_2$ on the unit
circle.  Under the non-collinearity assumption, this condition
uniquely determines $p$ and $q$.  As illustrated in
Figure~\ref{fig:fig1}, the hyperbola meets the unit circle in one
additional point $z_3 = (x_3,y_3)$.  We have the following remarkable
relationship among the three points $z_1$, $z_2$, and $z_3$ on the
intersection of the circle and hyperbola.

\begin{lemma}[hyperbolic addition on the circle] \label{lemma:ha} Let
  $z_0=(-1,0)$, $z_1$, $z_2$ and $z_3$ be four distinct points on the
  intersection of the unit circle with a hyperbola whose asymptotes
  run parallel to the coordinate axes.  Then with respect to the group
  law on the unit circle, we have $z_1 z_2 z_3 = 1$.
\end{lemma}

The lemma is a special case of a more general lemma
(Lemma~\ref{lemma:hyperbola}) that is proved later in this article.

This gives a geometric construction of the group law: the product of
the two points $z_1$ and $z_2$ on the unit circle is $\iota(z_3)$.
Rather than starting with the formula (\ref{eqn:cx}), we can reverse
the process, defining a binary operation on the circle by
\[
z_1 \oplus z_2 = \iota(z_3)
\]
when $z_1$, $z_2$, and $z_3$ are related by the circle and hyperbola
intersection construction.  We call the binary operation $\oplus$ {\it
  hyperbolic addition} on the circle.

It might seem that there is no point in reinterpreting complex
multiplication on the unit circle as hyperbolic addition, because they
are actually the same binary operation, and complex multiplication is
already perfectly well-understood.  However, in the next section, we
will see that hyperbolic addition generalizes in ways that ordinary
complex multiplication does not.  In this sense, we have found a
better description of the group law on the circle.


% Fig1

\tikzfig{fig1}{A unit circle centered at the origin
and hyperbola meet at four points $z_0 = (-1,0)$, $z_1$, $z_2$, and $z_3$,
where $z_1 z_2 z_3 = 1$, which we write alternatively in additive notation 
as $z_1\oplus z_2 = \iota(z_3)$.}{
{
\draw (0,0) circle (1);
\draw plot[smooth] file {figC1.table};
\draw plot[smooth] file {figC2.table};
\smalldot {-1,0} node[anchor=east] {$z_0$};
\smalldot {12/13,5/13} node[anchor=west] {$z_1$};
\smalldot {7/25,24/25} node[anchor=south west] {$z_2$};
\smalldot {-36/325,-323/325} node[anchor=north east] {$z_3$};
}
}

% We work a numerical example that is illustrated in
% Figure~\ref{fig:fig1}.  Let $z_1 = (12/13,5/13)$, and $z_2 =
% (7/25,24/25)$ be points on the unit circle coming from the
% Pythagorean triples $12^2 + 5^2 = 13^2$ and $7^2 + 24^2 = 25^2$.
% The hyperbola
%\[
%y = \frac{57 (1+x)} {-15 + 325 x}
%\]
%passes through $z_1$, $z_2$ and $(-1,0)$.  It has vertical asymptote
% $x = 3/65$ and horizontal asymptote $y = 57/325$.  The hyperbola
% also meets the unit circle at $z_3=(-36/325,-323/325)$.  We conclude
% that the the {\it hyperbolic sum} $z_1\oplus z_2$ of $z_1$ and $z_2$
% is $\iota(z_3)=(-36/325,323/325)$.  We can easily directly check our
% result by multiplying $z_1$ and $z_2$ as complex numbers:
%\[
%(\frac{12}{13} + i \frac{5}{13}) (\frac{7}{25} + i \frac{24}{25}) 
%= (-\frac{36}{325} + i \frac{323}{325}).
%\]


\section{Deforming the Circle}

We can use exactly the same hyperbola construction to define a binary
operation $\oplus$ on other curves.  We call this {\it hyperbolic
  addition} on a curve.  We replace the unit circle with a more
general algebraic curve $C$, defined by the equation
\begin{equation}\label{eqn:ed}
x^2 + c y^2 - 1 - d x^2 y^2
\end{equation} (up to a nonzero constant factor) for some parameters $c$ and $d$.
This zero locus of this polynomial is called an {\it Edwards curve}.%
\footnote{This definition is more inclusive than definitions stated elsewhere.  
  Most writers prefer to restrict to curves of genus one
  and generally call a curve with $c\ne 1$ a {\it twisted Edwards curve}.  
  We have interchanged the $x$ and $y$
  coordinates on the Edwards curve to make it 
  consistent with the group law on the circle.}  
The unit circle corresponds to
parameter values $c=1$ and $d=0$.


 
 % Fig 2.
 \tikzfig{fig2}{The figure on the left is an Edwards curve (with parameters $c=0$ and $d=-8$).  An Edwards curve 
and hyperbola meet at four points $z_0 = (-1,0)$, $z_1$, $z_2$, and $z_3$.
By construction, hyperbolic addition satisfies $z_1 \oplus z_2 = \iota(z_3)$.}{
{
\begin{scope}[xshift=0]
\draw plot[smooth] file {figE1.table};
\draw plot[smooth] file {figE2.table};
\end{scope}
\begin{scope}[xshift=5cm]
\draw plot[smooth] file {figE1.table};
\draw plot[smooth] file {figE2.table};
\draw plot[smooth] file {figE3.table};
\draw plot[smooth] file {figE4.table};
\smalldot {-1,0} node[anchor=east] {$z_0$};
\smalldot {0.9,0.158} node[anchor=west] {$z_1$};
\smalldot {0.2,0.853} node[anchor=south west] {$z_2$};
\smalldot {0.037,-0.993} node[anchor=north east] {$z_3$};
\end{scope}
}
}

We define a binary operation on the Edwards curve by the hyperbolic addition law described above.
Let $(-1,0)$, $z_1 = (x_1,y_1)$ and $z_2=(x_2,y_2)$ be three points on an Edwards curve
 that are not collinear (to avoid degenerate cases).  We fit a hyperbola of the usual form (\ref{eqn:hyp}) through these three points,
 and let $z_3$ be the fourth point of intersection of the hyperbola with the curve.  We define the hyperbolic sum
 $z_1\oplus z_2$ of $z_1$ and $z_2$ to be $\iota(z_3)$.
 The following lemma gives an explicit formula for $z_1\oplus z_2 = \iota(z_3)$.

 
 \begin{lemma}\label{lemma:hyp} In this construction, the coordinates are given explicitly by
 \begin{equation}\label{eqn:sum}
 \iota(z_3) = \left(\frac{x_1 x_2 - c y_1 y_2}{1 - d x_1 x_2 y_1 y_2},\frac{x_1 y_2 + y_1 x_2}{1+d x_1 x_2 y_1 y_2}\right)
 \end{equation}
 \end{lemma}

This lemma will be proved below (Lemma~\ref{lemma:hyperbola}).
Until now, we have assumed the points $(-1,0)$, $z_1$, and $z_2$ are not collinear.  
Dropping the assumption of non-collinearity, we turn formula (\ref{eqn:sum})
of Lemma~\ref{lemma:hyp} into a definition and define the hyperbolic sum
\[
 z_1\oplus z_2 := \iota(z_3).
\]
algebraically by that formula in all cases.  We prove below an affine
closure result (Lemma~\ref{lemma:affine}) showing that this formula
works without fail (that is, the denominators are always nonzero) for
suitable parameters $c$ and $d$.

The unit circle belongs to the family of Edwards curves for parameter
values $c=1$ and $d=0$.  In this case, the formula reduces to the
familiar formula for multiplication:
\begin{equation}\label{eqn:cx}
(x_1,y_1) * (x_2,y_2) = (x_1 x_2 - y_1 y_2,x_1 y_2 + x_2 y_1).
\end{equation}

In the next section, we prove quite generally that hyperbolic addition
makes the Edwards curve into a group.

\section{Group Axioms}

Our primary aim is to give an elementary proof of the group axioms for
hyperbolic addition on Edwards curves (Theorem~\ref{thm:group}).  In
this section, we start afresh, setting aside just about everything,
except for the definition of the Edwards curve (\ref{eqn:ed}) and
the formula (\ref{eqn:sum}).  We shift away from
a geometric language and work entirely algebraically over an arbitrary
field $k$.

\subsection{rings and homomorphisms}

We try to keep our presentation at an undergraduate level.
We will assume a basic background in abstract algebra at the level of a first course (rings, fields, homomorphisms, and kernels).
We set things up in a way that all of the main identities to be proved are identities of polynomials with integer coefficients.

If $R$ is a ring (specifically, a ring of polynomials with integer coefficients), and if $\delta\in R$, then we write
$R[\f{\delta}]$ for the localization of $R$ with respect to the multiplicative set $S=\{1,\delta,\delta^2,\ldots\}$.  That is,
$R[\f{\delta}]$ is the ring of fractions with numerators in $R$ and denominators in $S$.  We will need the 
well-known fact that if $\phi:R\to A$
is a ring homomorphism that sends $\delta$ to a unit in $A$, then $\phi$ extends uniquely to a homomorphism
$R[\f{\delta}]\to A$ that maps a fraction $g/\delta^i$ to $\phi(g)\phi(\delta^i)^{-1}$.

\begin{lemma}[kernel property] Suppose that an identity $g = r_1 e_1 +
  r_2 e_2 +\cdots + r_k e_k$ holds in a ring $R$.  If $\phi:R\to A$ is
  a ring homomorphism such that $\phi(e_i) =0$ for all $i$, then
  $\phi(g)=0$.
\end{lemma}

\begin{proof}
$\phi(g) = \sum_{i=1}^k \phi(r_i) \phi(e_i) = 0.$
\end{proof}

We use the following rings: $R_0 := \ring{Z}[c,d]$ and $R_n :=
R_0[x_1,y_1,\ldots,x_n,y_n]$.  We reintroduce the polynomial for the
Edwards curve.  Let
\begin{equation}
e(x,y) = x^2 + c y^2 -1 - d x^2 y^2 \in  R_0[x,y].
\end{equation}



We write $e_i = e(x_i,y_i)$ for the image of the polynomial in $R_j$, for $i\le j$, under $x\mapsto x_i$ and $y\mapsto y_i$.
Set
\[\delta^\pm=\delta^{\pm} (x_1,y_1,x_2,y_2) = 1\pm d x_1 y_1 x_2 y_2\] and
\[
\delta(x_1,y_1,x_2,y_2) = 1 - d^2 x_1^2 y_1^2 x_2^2 y_2^2 =\delta^+\delta^-\in R_2.
\]
We write $\delta_{ij}$ for its image of $\delta$ under $(x_1,y_1,x_2,y_2)\mapsto (x_i,y_i,x_j,y_j)$.  So, $\delta=\delta_{12}$.

\subsection{inverse and closure}

Borrowing the definition of hyperbolic addition from the previous section,
we define a pair of rational functions that we denote using the symbol $\oplus$:
\begin{equation}\label{eqn:add}
(x_1,y_1) \oplus (x_2,y_2) =  \left(\frac{x_1 x_2 - c y_1 y_2}{1 - d x_1 x_2 y_1 y_2},\frac{x_1 y_2 + y_1 x_2}{1+d x_1 x_2 y_1 y_2}\right) \in R_2[\f{\delta}]\times R_2[\f{\delta}].
\end{equation}
Commutivity is a consequence of the subscript symmetry $1\leftrightarrow 2$ evident in the pair of rational functions:
\[
(x_1,y_1) \oplus (x_2,y_2) = (x_2,y_2) \oplus (x_1,y_1).
\]
If $\phi:R_2[\f{\delta}]\to A$ is a ring homomorphism, we also write $(a_1,b_1)\oplus (a_2,b_2)\in A^2$ for the image
of $(x_1,y_1)\oplus (x_2,y_2)$, where $x_1,y_1,x_2,y_2 \mapsto^\phi a_1,b_1,a_2,b_2$.  We write $\bar e_i=\bar e(a_i,b_i)\in A$ for the
image of $e_i$ under $\phi$.  Geometrically,
$\bar e_i=0$ asserts that $(a_i,b_i)$ is a point on the Edwards curve.
More generally, we often mark the image $\bar g=\phi(g)$ of an element with a bar accent.

There is an obvious identity element $(1,0)$, expressed as follows.  Under a homomorphism
$\phi:R_2[\f{\delta}]\to A$, mapping $x_1,y_1,x_2,y_2\mapsto a,b,1,0$,
we have $(a,b)\oplus(1,0) = (a,b)$.

\begin{lemma} [inverse] 
Under a homomorphism
$\phi:R_2[\f{\delta}]\to A$, with $x_1,y_1,x_2,y_2\mapsto a_1,b_1,a_1,-b_1$,
we have $(a_1,b_1)\oplus (a_1,-b_1) = (1,0)$, provided $\bar e_1=0$. 
\end{lemma}

\begin{proof}  Plug $(a_1,b_1)$ and $(a_1,-b_1)$ into  (\ref{eqn:add})
and simplify using $\bar e_1=0$.
\end{proof}

\begin{lemma}[closure under addition]\label{lemma:closure}
Let $\phi:R_2[\f{\delta}]\to A$ be a ring homomorphism with $x_1,y_1,x_2,y_2 \mapsto^\phi a_1,b_1,a_2,b_2$.
If $\bar e_1 = \bar e_2 = 0$ then ${\bar e}(a_3,b_3) = 0$, where $(a_3,b_3) = (a_1,b_1)\oplus (a_2,b_2)$.
\end{lemma}

\begin{proof} This proof serves as a model for several proofs that
  are based on multivariate polynomial division.  We write
\[
e(x_3',y_3') = \frac{g}{\delta^2},\quad \text{ where } (x_3',y_3')=(x_1,y_1) \oplus (x_2,y_2) ,\quad 
\]
for some polynomial $g \in R_2$.  It is enough to show that $\phi(g)=0$.
Polynomial division gives
\begin{equation}\label{eqn:closure}
g= r_1 e_1 + r_2 e_2,
\end{equation}
for some polynomials $r_i\in R_2$.  Concretely, the polynomials $r_i$
are obtained as the output of the one-line Mathematica command
\[
\op{PolynomialReduce}[g,\{e_1,e_2\},\{x_1,x_2,y_1,y_2\}].
\]
The result now follows from the kernel
property and (\ref{eqn:closure}); $\bar e_1 = \bar e_2 = 0$ implies
$\phi(g)= 0$, giving ${\bar e}(a_3,b_3)=0$.
\end{proof}

 Although the documentation is incomplete, the function {\tt PolynomialReduce}
  seems to be
  an implementation of a naive multivariate 
  division algorithm such as \cite{cox1992ideals}.  In particular, our
  approach does not require the use of Gr\"obner bases (except in
  Lemma \ref{lemma:noco} 
  where they make an easily avoidable appearance).  We write
\[
g \cong 0 \mod S,
\]
where $g$ is a polynomial and $S$ is a set of polynomials, to indicate
that $g$ has zero remainder when reduced by polynomial division\footnote{Our computer algebra
calculations are available at \url{www.github.com/flyspeck}.  This includes
a formal verification in HOL Light of key polynomial identities.} with
respect to $S$ using {\tt PolynomialReduce}.  The zero remainder will
give $\phi(g)=0$ in each application.  Using this approach, most of the
proofs in this article almost write themselves.


\subsection{associativity}

This next step (associativity) is generally considered the hardest
part of the verification of the group law on curves.  Our proof is six lines
and requires little more than polynomial division.  The polynomials
$\delta^\pm$ appear as denominators in the addition rule.  The
polynomial denominators $\Delta^\pm$ that appear when we add twice are
more involved.  Specifically, let $ (x_3',y_3')=(x_1,y_1) \oplus
(x_2,y_2)$, let $(x_1',y_1')=(x_2,y_2) \oplus (x_3,y_3) $, and set
\[
\Delta^{\pm} = \delta^\pm(x_3',y_3',x_3,y_3)
\delta^\pm(x_1,y_1,x_1',y_1')\delta_{12}\delta_{23}\in R_3.
\]

\begin{lemma}[associativity] \label{lemma:assoc} Let
  $\phi:R_3[\f{\Delta^+\Delta^-}]\to A$ be a homomorphism sending
  $x_i,y_i\mapsto a_i,b_i$.  Assume $\bar e_1 = \bar e_ 2= \bar e_3 =
  0$. Then
\[
((a_1,b_1)\oplus (a_2,b_2)) \oplus (a_3,b_3)=
(a_1,b_1)\oplus ((a_2,b_2) \oplus (a_3,b_3)).
\]
\end{lemma}

\begin{proof} The proof is almost identical to the previous proof.  We
  work in the ring $R_3[\f{\Delta^+\Delta^-}]$ and take the
  component-wise difference of the two sides, writing
\[
((x_1,y_1)\oplus (x_2,y_2)) \oplus (x_3,y_3)-
(x_1,y_1)\oplus ((x_2,y_2) \oplus (x_3,y_3)) 
= (\frac{g_1}{\Delta^-},\frac{g_2}{\Delta^+}),
\]
for some polynomials $g_1,g_2 \in R_3$.  
It is enough to show that $\phi(g_1)=\phi(g_2)=0$. 
Polynomial division implies the desired result:
\[
(g_1,g_2)\cong (0,0) \mod \{e_1,e_2,e_3\}.
\]
\end{proof}

\subsection{group law for affine curves}

\begin{lemma}[affine closure] \label{lemma:affine} Let $\phi:R_2\to k$
  be a homomorphism into a field $k$.  If $\phi(\delta)=\bar e_1=\bar
  e_2=0$, then either $\bar d$ or $\bar c \bar d$ is a nonzero square
  in $k$.
\end{lemma}

The lemma is sometimes called completeness, in conflict with the
definition of complete varieties in algebraic geometry.  To avoid
possible confusion, we avoid this terminology.

\begin{proof} 
  Let $g = (1 - c d y_1^2 y_2 ^2) (1 - d y_1^2 x_2^2)$.  By polynomial
  division,
\begin{equation}\label{eqn:squares}
  g \cong 0 \mod \{\delta,e_1,e_2\}.
\end{equation}
This forces $\phi(g)=0$, which by the form of $g$ implies that $\bar
c\bar d$ or $\bar d$ is a nonzero square.
\end{proof}

We are ready to state and prove one of the main results of this
article.  This ``ellipstical'' group law is expressed generally enough
to include the group law on the circle and ellipse as a special case 
$\bar d = 0$.

\begin{theorem}[group law]\label{thm:group} 
  Let $k$ be a field, let $\bar c \in k$ be a square, and let $\bar
  d\not\in k^{\times 2}$.  Let $\bar e(x,y) \in k[x,y]$ be the
  specialization of $e(x,y)$, obtained by $(c,d)\mapsto (\bar c,\bar
  d)$.  Then $C= \{(a,b)\in k^2 \mid \bar e(a,b) = 0\}$ is an abelian
  group with binary operation $\oplus$.
\end{theorem}

\begin{proof} This follows directly from the earlier results.  For
  example, to check associativity of $(a_1,b_1)\oplus (a_2,b_2) \oplus
  (a_3,b_3)$, where $(a_i,b_i)\in C$, we define a homomorphism
  $\phi:R_3\to k$ sending $(x_i,y_i)\mapsto (a_i,b_i)$ and
  $(c,d)\mapsto (\bar c,\bar d)$.  By a repeated use of the affine
  closure lemma, $\phi(\Delta^+\Delta^-)$ is nonzero and invertible in
  the field $k$.  The universal property of localization extends
  $\phi$ to a homomorphism $\phi:R_3[\f{\Delta^+\Delta^-}]\to k$.  By
  the associativity lemma applied to $\phi$, we obtain the
  associativity for these three (arbitrary) elements of $C$.  The
  other properties follow similarly from the lemmas on closure,
  inverse, and affine closure.
\end{proof}

\section{Group law for projective Edwards curves}

This section show how to remove the restriction $\bar d\not\in
k^{\times 2}$ that appears in the group law in the previous section.
By removing this restriction, we obtain a new proof of the group law for all elliptic
curves in characteristics different from $2$.  Unfortunately, in this
section, some case-by-case arguments are needed.

The basic idea of our construction that if $\Eoo$ is the set of affine
points on the Edwards curve with nonzero coordinates, then the set of
points $G$ we must add to compactify is an abelian group of order eight that acts
as autormophisms of $\Eoo$.  We obtain a binary operation on the
projective curve $\Eoo\sqcup G$ by merging hyperbolic addition on $\Eoo$
with the group action of $G$ on $\Eoo$.  It will be associative by the
underlying associativity of the binary operations that are merged.


Let $k$ be a field of characteristic different from $2$.  In this
section, we assume that $c\ne 0$ and that $c$ and $d$ are both
squares.  Let $t^2 = d/c$.  By a change of variable $y\mapsto
y/\sqrt{c}$, the Edwards curve takes the form
\begin{equation}\label{eqn:t}
e(x,y)= x^2 + y^2 -1 - t^2 x^2 y^2.
\end{equation}

We assume $t^2\ne 1$.  Note if $t^2=1$, then Equation (\ref{eqn:t})
becomes
\[
(1-x^2)(1-y^2),
\]
and the curve degenerates to a product of lines.  We also assume that
$t\ne 0$, which excludes the circle, which has already been fully
treated.  Shifting notation for this new setting, let
\[
R_0 = \ring{Z}[t,\frac{1}{t^2-1},\frac1t],\quad
R_n = R_0[x_1,y_1,\ldots,x_n,y_n].
\]
We write $e_i = e(x_i,y_i)$, and $\bar e_i = \phi(e_i)$ when a
homomorphism $\phi$ is given.

Let $\Eo$ be the set of solutions of Equation (\ref{eqn:t}) with
coordinates $x,y$ in the field $k$.  Let $\Eoo\subset E^0$ be the set
of points such that $x\ne0$ and $y\ne 0$.

Let $G$ be the abelian group of order eight generated by the following
two permutations $\rho,\tau$ of the set $\Eoo$:
\[
\rho(x,y) = (-y,x),\quad \tau(x,y) = (1/(tx),1/(ty)).
\]
It is immediate that these two permutations carry $\Eoo$ to $\Eoo$.

Define $E = G\sqcup \Eoo$.  We will show that $E$ can be made into a
group.  The binary operation 
combines $\oplus$ with the action of $G$ on $\Eoo$.

Let $[g] = g(1,0)\in \Eo$.  Then $\{[g]\mid g\in \Go\} = \Eo \setminus
\Eoo$ and $[g]\oplus Q = g Q$, for $g\in \Go$ and $Q\in \Eoo$.

We define an action $G\times E\to E$ by
\[
(g,P)\mapsto \begin{cases}g P,& P\in \Eoo;\\
g g_1,& P = g_1\in G.
\end{cases}
\]
It is easy to check that this is indeed an action of $G$ on $E$, using
the fact that $G$ acts on $\Eoo$ and on $G$ by left multiplication.

\begin{lemma}  \label{lemma:no-fix}
  $G$ acts without fixed point on $E$.  That is, $g P = P$ implies
  that $g=e_G\in G$.
\end{lemma}

\begin{proof} If $P=g_1\in G$, then $g g_1 = g_1$ clearly implies that
  $g=e_G$.  If $g = \rho^k\ne e_G$, then $g P = P$ implies that $t x y
  = - t x y$ and $x=y=0$, which is not a point on the curve.  If $g =
  \tau \rho^k$, then the fixed point condition $g P = P$ leads to $t
  x^2 = t y^2 =\pm 1$.  Such a point can lie on the curve only
when $t^2=1$, which is contrary to our standing assumption.
\end{proof}

We extend the binary operation $\oplus$ as follows.  The idea is to
set 
\begin{equation}\label{eqn:tauplus}
P\oplus' Q = \tau((\tau P)\oplus Q).
\end{equation}
More formally, calculating the right-hand side in terms of coordinates, 
 we define $(\oplus')$ by a pair of rational functions
\[
(x_1,y_1)\oplus' (x_2,y_2) := \left(\frac{x_1y_1 - x_2 y_2}{x_2
    y_1-x_1 y_2},\frac{x_1 y_1 + x_2 y_2}{x_1 x_2 + y_1 y_2}\right) 
    \in R_2[\f{\delta'}].
\]
Let
\[
\delta'_+(x_1,y_1,x_2,y_2) = x_2 y_1 - x_1 y_2,
\quad \delta'_-(x_1,y_1,x_2,y_2)= x_1 x_2 + y_1 y_2,
\quad \delta' = \delta'_+ \delta'_-
\] 
be the denominators.

\begin{lemma}  
  Let $\phi:R_2[\f{\delta'}]\to R$.  Let $(a_i,b_i)$ be the image of
  $(x_i,y_i)$.  Let $(a_3,b_3)=(a_1,b_1)\oplus' (a_2,b_2)$.  If $\bar
  e_1 = \bar e_2 = 0$, then $e(a_3,b_3)=0$.
\end{lemma}

\begin{proof} Follow the proof of Lemma \ref{lemma:closure} to reduce to an
identity
\[
g\cong 0 \mod \{e_1,e_2\}.
\].
\end{proof}

\begin{lemma} \label{lemma:extend} Let $\phi:R_2[\f{\delta'\delta}]\to
  A$ be a homomorphism sending $x_i,y_i\mapsto a_i,b_i$.  Assume $\bar
  e_1 = \bar e_ 2 = 0$. Then
\[
(a_1,b_1)\oplus (a_2,b_2)=(a_1,b_1)\oplus' (a_2,b_2).
\]
\end{lemma}

\begin{proof} Write
\[
((x_1,y_1)\oplus (x_2,y_2)) -
((x_1,y_1)\oplus' (x_2,y_2) ) = 
(\frac{g_1}{\delta^+\delta'_+},\frac{g_2}{\delta^-\delta'_-}),
\]
for some polynomials $g_1,g_2$.   Polynomial division gives
\[
(g_1,g_2) \cong (0,0) \mod \{e_1,e_2\}.
\]
\end{proof}

Using this compatibility, we define $\oplus''$ on the domain
\begin{align*}
\{(a_1,b_1,a_2,b_2)\in \Eo\times \Eo &\mid 
\delta(a_1,b_1,a_2,b_2)\ne 0 \vee
\delta'(a_1,b_1,a_2,b_2)\ne 0 \},
\end{align*}
that restricts to $\oplus$ and $\oplus'$ where defined.  We say that
$P=(a_1,b_1), Q=(a_2,b_2)\in \Eo$ are {\emph {composable}}, if
$(a_1,b_1,a_2,b_2)$ lies in this domain.

\begin{lemma}\label{lemma:noco} 
  If $P=(a_1,b_1),Q=(a_2,b_2)\in \Eo$ are not composable, then there
  exists $g\in G$ such that $Q= gP^{-1}$.
\end{lemma}

\begin{proof} If $P$ or $Q$ is in $G$, then the result is immediate.
  Assume that $P,Q\in \Eoo$.  Set $\tau Q = Q_0 = (a_0,b_0)$. Then
\[
Q = \tau Q_0 = (1/(t a_0),1/(t b_0)).
\]
It is enough to show that
\begin{equation}\label{eqn:gp-}
(a_0,b_0) \in \{\pm (b_1,a_1),\pm (a_1,-b_1)\} = \Go P^{-1}.
\end{equation}
We analyze the vanishing of the denominators of $\oplus$ and
$\oplus'$.  Replacing $Q_0$ by $\rho Q_0$ if needed, which exchanges
$\delta^+\leftrightarrow \delta^-$, we may assume that
$\delta^+(a_1,b_1,1/(t a_0),1/(t b_0))=0$.  Let $S$ be the Gr\"obner
basis of the polynomials $e_1,e_2, q x_0 x_1 y_0 y_1 - 1$ and the
numerators of
\[
\delta^+(x_1,y_1,1/(t x_0),1/(t y_0)),\quad \text{and}\quad
\delta_-'(x_1,y_1,1/(t x_0),1/(t y_0)).
\]
Polynomial division gives
\[
(x_0^2-y_1^2,x_1^2-y_0^2,x_0 y_0 - x_1 y_1) \cong (0,0,0) \mod S.
\]
These equations immediately yield $(a_0,b_0) = \pm (b_1,a_1)$ and
(\ref{eqn:gp-}).  Now let $S$ be the Gr\"obner basis of the polynomials
$e_1,e_2, q x_0 x_1 y_0 y_1 - 1$ and the numerators of
\[
\delta^+(x_1,y_1,1/(t x_0),1/(t y_0)),\quad \text{and}\quad
\delta_+'(x_1,y_1,1/(t x_0),1/(t y_0)).
\]
Polynomial division gives
\[
(x_0^2-x_1^2,y_0^2-y_1^2,x_0 y_0 - x_1 y_1) \cong (0,0,0) \mod S.
\]
These equations immediately yield $(a_0,b_0) = \pm (a_1,-b_1)$ and
(\ref{eqn:gp-}).  In summary, we have $\tau Q = Q_0 = (a_0,b_0) = g
P^{-1}$, for some $g\in \Go$.  Then $Q = \tau g P^{-1}$.
\end{proof}

We define a group structure on $E$ by merging the binary operations
that are available.  $e_G\in G\subset E$ serves as the group identity
element.  Note that $[e_G] = (1,0)$, the identity defined earlier for
Edwards curve addition.  The inverse $P\mapsto P^{-1}$ is $g\mapsto
g^{-1}$ on $G$ and $(x,y)\mapsto (x,-y)$ on $\Eoo$.  From here on, we
write the inverse on $\Eo$ in multiplicative notation $P\mapsto
P^{-1}$.  We define addition $\hplus$ by
\begin{equation}
P\hplus Q = \begin{cases}
g_1 g_2,& P = g_1, Q = g_2 \in G;\\
g_1 Q,& P = g_1\in G,  Q\in \Eoo;\\
g_2 P,& P \in \Eoo, Q = g_2\in G;\\
P\oplus'' Q,& P,Q\in \Eoo \text{ (if composable)};\\
g,& Q = g P^{-1}, P,Q\in \Eoo, g\in G.
\end{cases}
\end{equation}
By Lemma \ref{lemma:noco}, the definition covers all $P,Q\in E$.  The
element $g\in G$ in the last case is uniquely determined by Lemma
\ref{lemma:no-fix}.

We remark that our definition of addition on the complete curve is
essentially equivalent to the definition in
\cite{bernstein2011complete}.  A cosmetic difference is that we label
points at infinity by $g\in G$, rather than using projective
coordinates.  The action of $G$ on $E$ extends to an action on
$\ring{P}^1_k\times \ring{P}^1_k$.  Let $[g] = g (1,0)\in
\ring{P}^1_k\times \ring{P}^1_k$.  Then $\Eoo\sqcup \{[g]\mid g\in
G\}$ is the completion of $\Eoo$ in $\ring{P}^1_k\times \ring{P}^1_k$.
This gives the translation from our representation to that of
\cite{bernstein2011complete}.


It is easily checked that for all $P,Q\in E$,  and all $g\in G$ we have
\begin{equation}\label{eqn:cid}
P\hplus Q = Q\hplus P,\quad 
e_G \hplus P = P,\quad P^{-1} \hplus P = e_G,\quad (g P)^{-1} = g^{-1} P^{-1}
\end{equation}
Also, if $g\in \Go$ and $P\in \Eo$, then
\[
 g P = [g]\oplus P = [g] \oplus' P.
\]

\begin{lemma}\label{lemma:pseudo} For all $g\in G$ and all $P,Q,R\in E$, we have
\begin{align}
g (P\hplus Q) &= (g P)\hplus Q;\\
(P\hplus Q)\hplus R &= P \hplus (Q\hplus R).
\end{align}
\end{lemma}

\begin{proof}  
  Note that the first equation is a special case of the second, when
  $R=g\in G$.  We prove the first equation.  Easy case splits
  according to $G\sqcup \Eoo$ reduce the proof to $P,Q\in \Eoo$ and
  $\hplus =\oplus''$.  It is then enough to check the equation on the
  generators $g=\rho,\tau$ of $G$.  For $\rho$, this reduces to an easy
  identity of rational functions (no polynomial division is required);
  and for $\tau$, we recover the defining relation of $\oplus'$ in
  Equation \ref{eqn:tauplus}.

  Next, we prove associativity.  Again, easy case splits
  according to $G\sqcup \Eoo$ reduce the proof quickly to $P,Q,R\in
  \Eoo$ and $\hplus = \oplus''$, using the first equation to handle
  cases where one of the points lies in $G$.  Case splits also reduce
  us quickly to the situation where all intermediate and final sums in
  the equation belong to $\Eoo$.  We can make use of the symmetries
  from the first equation to reduce the number of cases in the second,
  by using $\tau$ to replace $\oplus'$ with $\oplus$ as in Equation
  \ref{eqn:tauplus}.  Replacing $P,Q,R$ by $\tau P$, $\tau Q$, and $\tau
  R$ if needed, we may now assume that all the sums on the left-hand
  side of the equation are composable and computed using
  $\oplus''=\oplus$.  We have four cases on the right depending on
  $\oplus'' =\oplus,\oplus'$.  We prove each identity by polynomial
  division, exactly as in Lemma \ref{lemma:assoc}, which is one of the
  four required identities.
\end{proof}

\begin{corollary} $E$ is an abelian group under addition $\hplus$.
\end{corollary}

\begin{proof} This follows from earlier observations about the 
  identity element and inverse (\ref{eqn:cid}),
  and associativity (Lemma \ref{lemma:pseudo}).
\end{proof}

\section{Hyperbola Lemma}

Our proof of the group axioms in the previous section does not
logically depend on the geometric interpretation of addition as
intersection points with a hyperbola.  Here we show that the addition
formula (\ref{eqn:sum}) is indeed given by hyperbolic addition (when a
determinant $D$ is nonzero).

Three points $(x_0,y_0)$, $(x_1,y_1)$, and $(x_2,y_2)$ in the plane
are collinear if and only if the following determinant is zero:
\[
\begin{vmatrix}
x_0 & y_0 & 1\\
x_1 & y_1 & 1\\
x_2 & y_2 & 1
\end{vmatrix}.
\]
When $(x_0,y_0) = (-1,0)$, the determinant
is $D= (x_1+1) y_2 - (x_2+1) y_1\in R_2$. 
We recall the polynomial
\[
h(p,q,x,y) = x y + p (x+1) + q y \in R_0[p,q,x,y]
\]
representing our family of hyperbolas.
We can solve the two linear equations
\[
h(p,q,x_1,y_1)=h(p,q,x_2,y_2)=0
\]
uniquely for $p=p_0$ and $q=q_0$ in the ring $R_2[\f{D}]$ to obtain
$h(x,y) = h(p_0,q_0,x,y) \in R_2[\f{D}][x,y]$.  It represents the
unique hyperbola in the family passing through points and $(-1,0)$,
$(x_1,y_1)$, and $(x_2,y_2)$.
 
\begin{lemma}[hyperbolic addition]\label{lemma:hyperbola}
  Let $\phi:R_2[\f{D\delta}]\to A$ be a ring homomorphism sending
  $x_1,y_1,x_2,y_2\mapsto a_1,b_1,a_2,b_2$.  Let $(a_3,b_3) =
  (a_1,b_1)\oplus (a_2,b_2)$.  If $\bar e_1 = \bar e_2 = 0$, then
  $\bar h(a_3,-b_3) = 0$.
\end{lemma}

\begin{proof}
  We work in the ring $R_2[\f{D\delta}]$ and write
\[
h(x_3',-y_3') = \frac{g}{D\delta},\quad 
\text{where } (x_3',y_3') = (x_1,y_1)\oplus (x_2,y_2)
\]
for some polynomial $g \in R_2$.  Polynomial division gives
\begin{equation}\label{eqn:h}
g \cong 0 \mod \{e_1,e_2\}.
\end{equation}
\end{proof}

\section{Elliptic Curves}\label{sec:elliptic}

Assume in this section that the characteristic of the field is not
$2$.



Starting with the equation $x^2 (1-d y^2) = (1 - c y^2)$ of the
Edwards curve, we can multiply both sides by $(1- d y^2)$ to bring it
into the form
\[
w^2 = (1 - d y^2) (1 - c y^2),
\]
where $w = x (1 - d y^2)$.  This a Jacobi quartic.  It is an elliptic
curve whenever the polynomial in $y$ on the right-hand side has degree
four and is separable.  In particular, if $c=1$ and $d=t^2\ne 1$ , it is an
elliptic curve.

After passing to a quadratic extension if necessary, every elliptic
curve is isomorphic to an Edwards curve.  This observation can be used
to give a new proof that a general elliptic curve $E$ (say chord and
tangent addition in Weierstrass form) is a group.  To carry this out, 
write the explicit isomorphism $E\to E'$ to an Edwards curve taking
the binary operation $\oplus_E$ on $E$ to the group operation on the
Edwards curve.  Then associativity for $\oplus_E$ follows from
associativity on the Edwards curve.

\section{Acknowledgements}

A number of calculations are reworkings of
calculations found in Edwards, Bernstein, 
Lange et al.~\cite{edwards2007normal}, \cite{bernstein2008twisted},
\cite{bernstein2007faster}.  Inspiration for this article comes from
Bernstein and Lange's wonderfully gentle introduction to
elliptic-curve cryptography at the 31st Chaos Communication Congress
in December, 2014.  They use the group law on the circle to motivate
the group law on Edwards elliptic curves.  Hyperbolic addition is
introduced for Edwards elliptic curves in \cite{arene2011faster}.  A
proof of the associative law of elliptic curves using Gr\"obner bases was first
carried out by Friedl \cite{friedl}.

\bibliography{refs} 
\bibliographystyle{alpha}

\end{document}

% Friedl's elementary 
% http://math.rice.edu/~friedl/papers/AAELLIPTIC.PDF


\end{document}
